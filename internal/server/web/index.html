<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Massive ORB Scanner</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">ORB</div>
      <div>
        <div class="title">Massive Open-5m ORB Scanner</div>
        <div class="subtitle">09:35 filter → tick VWAP cross → TTS alerts</div>
      </div>
    </div>
    <div class="controls">
      <label class="toggle">
        <input id="audioToggle" type="checkbox" checked/>
        <span>Audio alerts</span>
      </label>
      <button id="testAudioBtn" class="btn">Test audio</button>
    </div>
  </header>

  <main class="grid">
    <section class="card">
      <h2>Status</h2>
      <div id="status" class="status"></div>
      <div class="kv">
        <div><span>Now (NY)</span><strong id="now"></strong></div>
        <div><span>Mode</span><strong id="mode"></strong></div>
        <div><span>Phase</span><strong id="phase"></strong></div>
        <div><span>Watchlist</span><strong id="watchCount"></strong></div>
        <div><span>Tracked</span><strong id="trackedCount"></strong></div>
        <div><span>Open</span><strong id="openTime"></strong></div>
        <div><span>09:35</span><strong id="selTime"></strong></div>
        <div><span>VWAP cutoff</span><strong id="cutoffTime"></strong></div>
        <div><span>11:00</span><strong id="exitTime"></strong></div>
      </div>
    </section>

    <section class="card">
      <h2>Filters</h2>
      <div class="hint">
        Edit values, then click <strong>Apply filters</strong>. (In historic mode this will replay the selected date.)
      </div>

      <div class="filters-grid">
        <div class="filters-group">
          <div class="filters-title">09:30–09:35 selection</div>
          <div class="frow">
            <label>Open5m Range% min</label>
            <input id="f_or_rng_min" class="input" type="number" step="0.001"/>
          </div>
          <div class="frow">
            <label>Open5m Range% max</label>
            <input id="f_or_rng_max" class="input" type="number" step="0.001"/>
          </div>
          <div class="frow">
            <label>Open5m Vol min</label>
            <input id="f_or_vol_min" class="input" type="number" step="1000"/>
          </div>
          <div class="frow">
            <label>Open5m Vol max</label>
            <input id="f_or_vol_max" class="input" type="number" step="1000"/>
          </div>
        </div>

        <div class="filters-group">
          <div class="filters-title">After 09:35 entry filters</div>
          <div class="frow">
            <label>Open5m Today% min</label>
            <input id="f_today_min" class="input" type="number" step="10"/>
          </div>
          <div class="frow">
            <label>Open5m Today% max</label>
            <input id="f_today_max" class="input" type="number" step="10"/>
          </div>
          <div class="frow">
            <label>Entry min minutes</label>
            <input id="f_entry_min" class="input" type="number" step="1"/>
          </div>
          <div class="frow">
            <label>Entry max minutes</label>
            <input id="f_entry_max" class="input" type="number" step="1"/>
          </div>
          <div class="frow">
            <label>Entry price min</label>
            <input id="f_px_min" class="input" type="number" step="0.1"/>
          </div>
          <div class="frow">
            <label>Entry price max</label>
            <input id="f_px_max" class="input" type="number" step="0.1"/>
          </div>
        </div>

        <div class="filters-group">
          <div class="filters-title">Historic “Sold off by 10:30” scan</div>
          <div class="frow">
            <label>Down from open% min (0.20 = 20%)</label>
            <input id="f_sold_pct_min" class="input" type="number" step="0.01"/>
          </div>
          <div class="frow">
            <label>Sold-off Open5m Range% min</label>
            <input id="f_sold_rng_min" class="input" type="number" step="0.001"/>
          </div>
          <div class="frow">
            <label>Sold-off Open5m Today% min</label>
            <input id="f_sold_today_min" class="input" type="number" step="10"/>
          </div>
        </div>
      </div>

      <button id="applyFiltersBtn" class="btn" style="margin-top:10px;">Apply filters</button>
      <div id="filtersStatus" class="hint" style="display:none; margin-top:8px;"></div>
    </section>

    <section id="historicCard" class="card wide" style="display:none">
      <div class="card-head">
        <div>
          <h2>Historic performance</h2>
          <div id="historicSubtitle" class="hint">Pick a date to replay the session.</div>
        </div>
        <div class="hist-controls">
          <button id="histPrevBtn" class="btn btn-icon" title="Previous day">◀</button>
          <input id="historicDate" class="date-input" type="date"/>
          <button id="histNextBtn" class="btn btn-icon" title="Next day">▶</button>
          <button id="histTodayBtn" class="btn" title="Jump to today">Today</button>
          <button id="histLoadBtn" class="btn" title="Replay selected date">Load</button>
          <label class="toggle" title="Show/hide performance tables">
            <input id="histPerfToggle" type="checkbox" checked/>
            <span>Performance</span>
          </label>
        </div>
      </div>

      <div id="historicNote" class="hint" style="display:none; margin-top:8px;"></div>

      <div id="histPerformanceWrap">
        <div class="hint">
          Assumes <strong>1000 shares</strong> per BUY. Realized P/L uses the engine’s actual exit trigger price.
          MFE/MAE are computed from entry → cutoff (config 11:00).
        </div>

        <div id="histSummary" class="summary-grid"></div>

        <h2 id="histTradesTitle" style="margin-top:14px">Trades</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Entry</th>
                <th>Entry px</th>
                <th>TP</th>
                <th>SL</th>
                <th>Exit</th>
                <th>Exit px</th>
                <th>Reason</th>
                <th>Realized %</th>
                <th>Realized $</th>
                <th>MFE %</th>
                <th>MFE $</th>
                <th>MAE %</th>
                <th>MAE $</th>
                <th>Hold→Cutoff %</th>
                <th>Hold→Cutoff $</th>
              </tr>
            </thead>
            <tbody id="tradesBody"></tbody>
          </table>
        </div>
      </div>

      <h2 id="noEntryTitle" style="margin-top:14px">Selected but no entry</h2>
      <div id="noEntryHint" class="hint">Useful for diagnosing false positives (no VWAP cross in the entry window, Today% filter failures, etc.).</div>

      <!-- NEW: chart slideshow controls (shown only in “Of interest” mode via JS) -->
      <div id="chartsToolbar" class="charts-toolbar" style="display:none">
        <button id="showChartsBtn" class="btn">Show Charts</button>
        <button id="chartPrevBtn" class="btn btn-icon" title="Previous chart">◀</button>
        <button id="chartNextBtn" class="btn btn-icon" title="Next chart">▶</button>
        <select id="chartListSelect" class="date-input" style="min-width:160px"></select>
        <select id="chartTickerSelect" class="date-input" style="min-width:120px"></select>
        <div id="chartCounter" class="hint" style="margin:0"></div>
      </div>

      <div id="chartPanel" class="chart-panel" style="display:none">
        <div class="chart-head">
          <div>
            <div id="chartSym" class="chart-sym">—</div>
            <div id="chartMeta" class="hint" style="margin:0"></div>
          </div>
          <div class="chart-actions">
            <button id="chartNextBarBtn" class="btn">Show next</button>
            <button id="chartRevealBtn" class="btn">Show Rest</button>
            <button id="hideChartsBtn" class="btn">Hide</button>
          </div>
        </div>
        <div id="chartContainer" class="chart-container"></div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Open5m Vol</th>
              <th>Open5m Range%</th>
              <th>Open5m Today%</th>
              <th>Saw Cross?</th>
              <th>First Cross</th>
              <th>Cross px</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody id="noEntryBody"></tbody>
        </table>
      </div>

      <h2 id="soldOffTitle" style="margin-top:14px">Sold off by 10:30</h2>
      <div id="soldOffHint" class="hint">Down hard from the open by 10:30 (historic scan).</div>

      <!-- NEW: Sold-off charts slideshow controls -->
      <div id="soldChartsToolbar" class="charts-toolbar" style="display:none">
        <button id="showSoldChartsBtn" class="btn">Show Charts</button>
        <button id="soldChartPrevBtn" class="btn btn-icon" title="Previous chart">◀</button>
        <button id="soldChartNextBtn" class="btn btn-icon" title="Next chart">▶</button>
        <select id="soldChartTickerSelect" class="date-input" style="min-width:120px"></select>
        <div id="soldChartCounter" class="hint" style="margin:0"></div>
      </div>

      <div id="soldChartPanel" class="chart-panel" style="display:none">
        <div class="chart-head">
          <div>
            <div id="soldChartSym" class="chart-sym">—</div>
            <div id="soldChartMeta" class="hint" style="margin:0"></div>
          </div>
          <div class="chart-actions">
            <button id="soldChartNextBarBtn" class="btn">Show next</button>
            <button id="soldChartRevealBtn" class="btn">Show Rest</button>
            <button id="hideSoldChartsBtn" class="btn">Hide</button>
          </div>
        </div>
        <div id="soldChartContainer" class="chart-container"></div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Drop%</th>
              <th>Open 09:30</th>
              <th>Low ≤10:30</th>
              <th>Low time</th>
              <th>Px @ 10:30</th>
              <th>Open5m Range%</th>
              <th>Open5m Vol</th>
              <th>Open5m Today%</th>
            </tr>
          </thead>
          <tbody id="soldOffBody"></tbody>
        </table>
      </div>
    </section>

    <section class="card wide">
      <h2>Tracked tickers</h2>
      <div class="hint">After 09:35 this list should be short (&lt; 20). Before 09:35 you’ll mostly see “collecting”.</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Status</th>
              <th>Last</th>
              <th>VWAP</th>
              <th>Min After Open</th>
              <th>Open 09:30</th>
              <th>Open5m Vol</th>
              <th>Open5m Range%</th>
              <th>Open5m Today%</th>
              <th>Entry</th>
              <th>TP</th>
              <th>SL</th>
            </tr>
          </thead>
          <tbody id="tickersBody"></tbody>
        </table>
      </div>
    </section>

    <section class="card wide">
      <h2>Event log</h2>
      <div id="events" class="events"></div>
    </section>
  </main>

  <audio id="player"></audio>
  <!-- Load TradingView Lightweight Charts BEFORE app.js -->
  <!-- Pin v4 so addCandlestickSeries/addLineSeries/addHistogramSeries exist -->
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script src="/app.js"></script>
</body>
</html>
